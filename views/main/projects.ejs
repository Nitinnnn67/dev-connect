<% layout("/layout/boilerplate") %>

<link rel="stylesheet" href="/css/projects.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- Projects Page Container -->
<div class="projects-container">
    <!-- Page Header -->
    <section class="projects-header">
        <div class="header-content">
            <div class="header-text">
                <h1>Discover Projects</h1>
                <p>Find and join exciting projects that match your skills</p>
            </div>
            <a href="/projects/new" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                Create Project
            </a>
        </div>
    </section>

    <!-- Search and Filters -->
    <section class="search-filter-section">
        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="Search projects by name, description, or technology...">
        </div>
        
        <div class="filters-container">
            <!-- Status Filter -->
            <div class="filter-group">
                <button class="filter-btn active" data-filter="all">
                    <i class="fas fa-th"></i>
                    All Projects
                </button>
                <button class="filter-btn" data-filter="active">
                    <i class="fas fa-circle" style="color: #28a745;"></i>
                    Active
                </button>
                <button class="filter-btn" data-filter="recruiting">
                    <i class="fas fa-users"></i>
                    Recruiting
                </button>
                <button class="filter-btn" data-filter="completed">
                    <i class="fas fa-check-circle"></i>
                    Completed
                </button>
            </div>

            <!-- Technology Filter -->
            <div class="filter-dropdown">
                <button class="dropdown-btn">
                    <i class="fas fa-code"></i>
                    Technology
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="dropdown-content">
                    <label><input type="checkbox" value="javascript"> JavaScript</label>
                    <label><input type="checkbox" value="python"> Python</label>
                    <label><input type="checkbox" value="react"> React</label>
                    <label><input type="checkbox" value="nodejs"> Node.js</label>
                    <label><input type="checkbox" value="mongodb"> MongoDB</label>
                    <label><input type="checkbox" value="docker"> Docker</label>
                </div>
            </div>

            <!-- Sort Options -->
            <select class="sort-select" id="sortSelect">
                <option value="recent">Most Recent</option>
                <option value="popular">Most Popular</option>
                <option value="members">Most Members</option>
                <option value="alphabetical">Alphabetical</option>
            </select>
        </div>
    </section>

    <!-- Projects Grid -->
    <section class="projects-grid-section">
        <div class="projects-grid" id="projectsGrid">
            <% if (projects.length === 0) { %>
                <!-- Empty State -->
                <div class="empty-state" style="grid-column: 1 / -1;">
                    <i class="fas fa-folder-open"></i>
                    <h3>No Projects Yet</h3>
                    <p>Be the first to create a project and start collaborating!</p>
                    <a href="/projects/new" class="btn btn-primary" style="margin-top: 20px;">
                        <i class="fas fa-plus"></i>
                        Create Project
                    </a>
                </div>
            <% } else { %>
                <% 
                    // Icon mapping for different project types
                    const iconMap = {
                        'javascript': 'fa-js',
                        'react': 'fa-react',
                        'node': 'fa-node-js',
                        'python': 'fa-python',
                        'web': 'fa-globe',
                        'mobile': 'fa-mobile-alt',
                        'ai': 'fa-brain',
                        'ml': 'fa-robot',
                        'data': 'fa-database',
                        'game': 'fa-gamepad',
                        'blockchain': 'fa-coins',
                        'iot': 'fa-microchip',
                        'default': 'fa-rocket'
                    };
                    
                    // Color gradients for variety
                    const gradients = [
                        'linear-gradient(135deg, #11293A 0%, #1e3a5f 100%)',
                        'linear-gradient(135deg, #3D4D55 0%, #11293A 100%)',
                        'linear-gradient(135deg, #B58863 0%, #D3C3B9 100%)',
                        'linear-gradient(135deg, #28a745 0%, #20c997 100%)',
                        'linear-gradient(135deg, #6f42c1 0%, #9b59b6 100%)',
                        'linear-gradient(135deg, #fd7e14 0%, #ffc107 100%)',
                        'linear-gradient(135deg, #dc3545 0%, #e74c3c 100%)',
                        'linear-gradient(135deg, #17a2b8 0%, #3498db 100%)'
                    ];
                %>
                
                <% projects.forEach((project, index) => { 
                    // Determine status class and text
                    let statusClass = '';
                    let statusText = '';
                    let statusFilter = '';
                    
                    if (project.status === 'open') {
                        statusClass = 'status-recruiting';
                        statusText = 'Recruiting';
                        statusFilter = 'recruiting';
                    } else if (project.status === 'in-progress') {
                        statusClass = 'status-active';
                        statusText = 'Active';
                        statusFilter = 'active';
                    } else if (project.status === 'completed') {
                        statusClass = 'status-completed';
                        statusText = 'Completed';
                        statusFilter = 'completed';
                    } else if (project.status === 'closed') {
                        statusClass = 'status-closed';
                        statusText = 'Closed';
                        statusFilter = 'closed';
                    }
                    
                    // Select icon based on tech stack
                    let projectIcon = iconMap['default'];
                    if (project.techStack && project.techStack.length > 0) {
                        const firstTech = project.techStack[0].toLowerCase();
                        for (let key in iconMap) {
                            if (firstTech.includes(key)) {
                                projectIcon = iconMap[key];
                                break;
                            }
                        }
                    }
                    
                    // Generate tech stack tags string for filtering
                    const techTags = project.techStack ? project.techStack.map(t => t.toLowerCase()).join(',') : '';
                    
                    // Select gradient
                    const gradient = gradients[index % gradients.length];
                    
                    // Owner info - check if createdBy exists
                    const ownerName = project.createdBy ? (project.createdBy.name || project.createdBy.username) : 'Unknown User';
                    const colors = ['11293A', 'B58863', '3D4D55', '2C5F2D', '97233F', '0E4C92', '8B4513', '2F4F4F'];
                    const bgColor = colors[index % colors.length];
                %>
                
                <div class="project-card" data-status="<%= statusFilter %>" data-tags="<%= techTags %>">
                    <div class="card-header">
                        <div class="project-icon" style="background: <%= gradient %>;">
                            <i class="fas <%= projectIcon %>"></i>
                        </div>
                        <span class="status-badge <%= statusClass %>"><%= statusText %></span>
                    </div>
                    
                    <h3 class="project-title"><%= project.title %></h3>
                    <p class="project-description">
                        <%= project.description.length > 120 ? project.description.substring(0, 120) + '...' : project.description %>
                    </p>
                    
                    <div class="project-tech">
                        <% if (project.techStack && project.techStack.length > 0) { %>
                            <% project.techStack.slice(0, 4).forEach(tech => { %>
                                <span class="tech-tag"><%= tech %></span>
                            <% }); %>
                            <% if (project.techStack.length > 4) { %>
                                <span class="tech-tag">+<%= project.techStack.length - 4 %></span>
                            <% } %>
                        <% } else { %>
                            <span class="tech-tag">General</span>
                        <% } %>
                    </div>
                    
                    <div class="project-meta">
                        <div class="meta-item">
                            <i class="fas fa-users"></i>
                            <span><%= project.members.length %><% if (project.teamSize) { %>/<%= project.teamSize %><% } %> Members</span>
                        </div>
                        <% if (project.duration) { %>
                            <div class="meta-item">
                                <i class="fas fa-calendar"></i>
                                <span><%= project.duration %></span>
                            </div>
                        <% } %>
                        <div class="meta-item">
                            <i class="fas fa-tasks"></i>
                            <span><%= project.tasks ? project.tasks.length : 0 %></span>
                        </div>
                    </div>
                    
                    <div class="project-footer">
                        <div class="project-owner">
                            <img src="https://ui-avatars.com/api/?name=<%= encodeURIComponent(ownerName) %>&size=32&background=<%= bgColor %>&color=fff" alt="<%= ownerName %>">
                            <span><%= ownerName %></span>
                        </div>
                        <a href="/projects/<%= project._id %>" class="view-btn">
                            View Details
                            <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <% }); %>
            <% } %>
        </div>

        <!-- Empty State for Search/Filter -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <i class="fas fa-search"></i>
            <h3>No Projects Found</h3>
            <p>Try adjusting your filters or search query</p>
        </div>
    </section>
</div>

<!-- GSAP Animation Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

<!-- Projects Page Scripts -->
<script src="/js/projects.js"></script>
<script src="/animations/projects-animat.js"></script>
