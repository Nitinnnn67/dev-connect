<% layout("/layout/boilerplate") %>

<link rel="stylesheet" href="/css/settings.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- Settings Container -->
<div class="settings-container">
    <!-- Settings Header -->
    <section class="settings-header">
        <div class="header-content">
            <h1>Settings</h1>
            <p>Manage your account and application preferences</p>
        </div>
    </section>

    <!-- Settings Content -->
    <div class="settings-content">
        <!-- Settings Sidebar -->
        <aside class="settings-sidebar">
            <nav class="settings-nav">
                <button class="nav-item active" data-section="account">
                    <i class="fas fa-user-circle"></i>
                    <span>Account</span>
                </button>
                <button class="nav-item" data-section="profile">
                    <i class="fas fa-id-card"></i>
                    <span>Profile</span>
                </button>
                <button class="nav-item" data-section="privacy">
                    <i class="fas fa-shield-alt"></i>
                    <span>Privacy & Security</span>
                </button>
                <button class="nav-item" data-section="notifications">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                </button>
                <button class="nav-item" data-section="appearance">
                    <i class="fas fa-palette"></i>
                    <span>Appearance</span>
                </button>
                <button class="nav-item" data-section="integrations">
                    <i class="fas fa-plug"></i>
                    <span>Integrations</span>
                </button>
                <button class="nav-item" data-section="billing">
                    <i class="fas fa-credit-card"></i>
                    <span>Billing</span>
                </button>
                <button class="nav-item" data-section="advanced">
                    <i class="fas fa-cog"></i>
                    <span>Advanced</span>
                </button>
            </nav>
        </aside>

        <!-- Settings Panels -->
        <div class="settings-panels">
            <!-- Account Settings -->
            <div class="settings-panel active" id="account-panel">
                <div class="panel-header">
                    <h2>Account Settings</h2>
                    <p>Manage your account information and credentials</p>
                </div>

                <div class="settings-card">
                    <h3>Basic Information</h3>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" value="<%= currentUser.email %>" readonly>
                        <small>Your email is verified <i class="fas fa-check-circle" style="color: #28a745;"></i></small>
                    </div>

                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" value="<%= currentUser.username %>" readonly>
                        <small>This is your unique identifier on DevConnect</small>
                    </div>

                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" value="<%= currentUser.name || '' %>" readonly>
                        <small>Update your name in <a href="/users/<%= currentUser._id %>/edit" style="color: var(--tertiary-color);">profile settings</a></small>
                    </div>

                    <a href="/users/<%= currentUser._id %>/edit" class="btn btn-primary">Edit Profile</a>
                </div>

                <form action="/settings/password" method="POST">
                    <div class="settings-card">
                        <h3>Change Password</h3>
                        <div class="form-group">
                            <label>Current Password</label>
                            <input type="password" name="currentPassword" placeholder="Enter current password" required>
                        </div>

                        <div class="form-group">
                            <label>New Password</label>
                            <input type="password" name="newPassword" placeholder="Enter new password (min 6 characters)" required minlength="6">
                        </div>

                        <div class="form-group">
                            <label>Confirm New Password</label>
                            <input type="password" name="confirmPassword" placeholder="Confirm new password" required minlength="6">
                        </div>

                        <button type="submit" class="btn btn-primary">Update Password</button>
                    </div>
                </form>

                <div class="settings-card danger-zone">
                    <h3><i class="fas fa-exclamation-triangle"></i> Danger Zone</h3>
                    <div class="danger-action">
                        <div>
                            <h4>Delete Account</h4>
                            <p>Permanently delete your account and all associated data. This action cannot be undone.</p>
                        </div>
                        <button class="btn btn-danger" id="deleteAccountBtn">Delete Account</button>
                    </div>
                </div>
            </div>

            <!-- Profile Settings -->
            <div class="settings-panel" id="profile-panel">
                <div class="panel-header">
                    <h2>Profile Settings</h2>
                    <p>Customize your public profile</p>
                </div>

                <div class="settings-card">
                    <h3>Profile Information</h3>
                    <p>Manage your profile details including bio, skills, and social links.</p>
                    <a href="/users/<%= currentUser._id %>/edit" class="btn btn-primary">Edit Profile</a>
                </div>

                <div class="settings-card">
                    <h3>Profile Visibility</h3>
                    <div class="toggle-group">
                        <div class="toggle-item">
                            <div>
                                <h4>Make profile public</h4>
                                <p>Allow others to view your profile and projects</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" <%= currentUser.profilePublic !== false ? 'checked' : '' %>>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div>
                                <h4>Show email on profile</h4>
                                <p>Display your email address to other users</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" <%= currentUser.showEmail ? 'checked' : '' %>>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <p style="margin-top: 1rem; color: var(--surface-variant); font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> These settings can be updated in your <a href="/users/<%= currentUser._id %>/edit" style="color: var(--tertiary-color);">profile edit page</a>
                    </p>
                </div>
            </div>

            <!-- Privacy & Security Settings -->
            <div class="settings-panel" id="privacy-panel">
                <div class="panel-header">
                    <h2>Privacy & Security</h2>
                    <p>Control your privacy and security settings</p>
                </div>

                <div class="settings-card">
                    <h3>Two-Factor Authentication</h3>
                    <div class="security-status">
                        <div class="status-indicator disabled">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div>
                            <h4>Two-Factor Authentication is disabled</h4>
                            <p>Add an extra layer of security to your account</p>
                            <button class="btn btn-primary">Enable 2FA</button>
                        </div>
                    </div>
                </div>

                <div class="settings-card">
                    <h3>Privacy Controls</h3>
                    <div class="toggle-group">
                        <div class="toggle-item">
                            <div>
                                <h4>Allow project invitations</h4>
                                <p>Let other users invite you to their projects</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div>
                                <h4>Show activity status</h4>
                                <p>Let others see when you're online</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div>
                                <h4>Allow direct messages</h4>
                                <p>Let other users send you direct messages</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="settings-card">
                    <h3>Active Sessions</h3>
                    <div class="sessions-list">
                        <div class="session-item">
                            <div class="session-icon">
                                <i class="fas fa-desktop"></i>
                            </div>
                            <div class="session-info">
                                <h4>Chrome on Windows <span class="current-badge">Current</span></h4>
                                <p>Last active: Just now • IP: 192.168.1.1</p>
                            </div>
                        </div>
                        <div class="session-item">
                            <div class="session-icon">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div class="session-info">
                                <h4>Mobile App on iOS</h4>
                                <p>Last active: 2 hours ago • IP: 192.168.1.2</p>
                            </div>
                            <button class="btn btn-secondary-small">Revoke</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notifications Settings -->
            <div class="settings-panel" id="notifications-panel">
                <div class="panel-header">
                    <h2>Notification Preferences</h2>
                    <p>Choose how you want to be notified</p>
                </div>

                <div class="settings-card">
                    <h3>Email Notifications</h3>
                    <div class="toggle-group">
                        <div class="toggle-item">
                            <div>
                                <h4>Project updates</h4>
                                <p>Get notified about updates to your projects</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div>
                                <h4>Team invitations</h4>
                                <p>Receive notifications when invited to projects</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div>
                                <h4>Task assignments</h4>
                                <p>Get notified when tasks are assigned to you</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div>
                                <h4>Comments and mentions</h4>
                                <p>Receive notifications for comments and mentions</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div>
                                <h4>Weekly digest</h4>
                                <p>Receive a weekly summary of activity</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="settings-card">
                    <h3>Push Notifications</h3>
                    <div class="toggle-group">
                        <div class="toggle-item">
                            <div>
                                <h4>Enable push notifications</h4>
                                <p>Receive real-time notifications on your devices</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div>
                                <h4>Play sound</h4>
                                <p>Play a sound for new notifications</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Appearance Settings -->
            <div class="settings-panel" id="appearance-panel">
                <div class="panel-header">
                    <h2>Appearance</h2>
                    <p>Customize how DevConnect looks</p>
                </div>

                <div class="settings-card">
                    <h3>Theme</h3>
                    <div class="theme-selector">
                        <div class="theme-option active" data-theme="light">
                            <div class="theme-preview light">
                                <div class="preview-header"></div>
                                <div class="preview-content"></div>
                            </div>
                            <h4>Light</h4>
                            <p>Clean and bright</p>
                        </div>

                        <div class="theme-option" data-theme="dark">
                            <div class="theme-preview dark">
                                <div class="preview-header"></div>
                                <div class="preview-content"></div>
                            </div>
                            <h4>Dark</h4>
                            <p>Easy on the eyes</p>
                        </div>

                        <div class="theme-option" data-theme="auto">
                            <div class="theme-preview auto">
                                <div class="preview-header"></div>
                                <div class="preview-content"></div>
                            </div>
                            <h4>Auto</h4>
                            <p>Follow system</p>
                        </div>
                    </div>
                </div>

                <div class="settings-card">
                    <h3>Display Preferences</h3>
                    <div class="form-group">
                        <label>Font Size</label>
                        <select>
                            <option>Small</option>
                            <option selected>Medium</option>
                            <option>Large</option>
                        </select>
                    </div>

                    <div class="toggle-group">
                        <div class="toggle-item">
                            <div>
                                <h4>Animations</h4>
                                <p>Enable smooth animations and transitions</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div>
                                <h4>Compact mode</h4>
                                <p>Display more content on screen</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Integrations Settings -->
            <div class="settings-panel" id="integrations-panel">
                <div class="panel-header">
                    <h2>Integrations</h2>
                    <p>Connect your favorite tools and services</p>
                </div>

                <div class="settings-card">
                    <h3>Connected Accounts</h3>
                    <div class="integrations-list">
                        <% if(currentUser.github) { %>
                        <div class="integration-item connected">
                            <div class="integration-icon github">
                                <i class="fab fa-github"></i>
                            </div>
                            <div class="integration-info">
                                <h4>GitHub</h4>
                                <p>Connected: <%= currentUser.github %></p>
                            </div>
                            <span class="connected-badge"><i class="fas fa-check-circle"></i> Connected</span>
                        </div>
                        <% } else { %>
                        <div class="integration-item">
                            <div class="integration-icon github">
                                <i class="fab fa-github"></i>
                            </div>
                            <div class="integration-info">
                                <h4>GitHub</h4>
                                <p>Connect your GitHub account</p>
                            </div>
                            <a href="/users/<%= currentUser._id %>/edit" class="btn btn-primary-small">Add in Profile</a>
                        </div>
                        <% } %>

                        <% if(currentUser.linkedin) { %>
                        <div class="integration-item connected">
                            <div class="integration-icon linkedin">
                                <i class="fab fa-linkedin"></i>
                            </div>
                            <div class="integration-info">
                                <h4>LinkedIn</h4>
                                <p>Connected: <%= currentUser.linkedin %></p>
                            </div>
                            <span class="connected-badge"><i class="fas fa-check-circle"></i> Connected</span>
                        </div>
                        <% } else { %>
                        <div class="integration-item">
                            <div class="integration-icon linkedin">
                                <i class="fab fa-linkedin"></i>
                            </div>
                            <div class="integration-info">
                                <h4>LinkedIn</h4>
                                <p>Connect your LinkedIn profile</p>
                            </div>
                            <a href="/users/<%= currentUser._id %>/edit" class="btn btn-primary-small">Add in Profile</a>
                        </div>
                        <% } %>

                        <% if(currentUser.twitter) { %>
                        <div class="integration-item connected">
                            <div class="integration-icon twitter">
                                <i class="fab fa-twitter"></i>
                            </div>
                            <div class="integration-info">
                                <h4>Twitter</h4>
                                <p>Connected: <%= currentUser.twitter %></p>
                            </div>
                            <span class="connected-badge"><i class="fas fa-check-circle"></i> Connected</span>
                        </div>
                        <% } else { %>
                        <div class="integration-item">
                            <div class="integration-icon twitter">
                                <i class="fab fa-twitter"></i>
                            </div>
                            <div class="integration-info">
                                <h4>Twitter</h4>
                                <p>Connect your Twitter account</p>
                            </div>
                            <a href="/users/<%= currentUser._id %>/edit" class="btn btn-primary-small">Add in Profile</a>
                        </div>
                        <% } %>
                    </div>
                </div>
            </div>

            <!-- Billing Settings -->
            <div class="settings-panel" id="billing-panel">
                <div class="panel-header">
                    <h2>Billing & Subscription</h2>
                    <p>Manage your subscription and payment methods</p>
                </div>

                <div class="settings-card">
                    <h3>Current Plan</h3>
                    <div class="plan-info">
                        <div class="plan-badge">Free Plan</div>
                        <p>You're currently on the free plan</p>
                        <button class="btn btn-primary">Upgrade to Pro</button>
                    </div>

                    <div class="plan-features">
                        <h4>Pro Plan Benefits</h4>
                        <ul>
                            <li><i class="fas fa-check"></i> Unlimited projects</li>
                            <li><i class="fas fa-check"></i> Priority support</li>
                            <li><i class="fas fa-check"></i> Advanced analytics</li>
                            <li><i class="fas fa-check"></i> Custom integrations</li>
                            <li><i class="fas fa-check"></i> Remove DevConnect branding</li>
                        </ul>
                    </div>
                </div>

                <div class="settings-card">
                    <h3>Payment Methods</h3>
                    <p>No payment methods added</p>
                    <button class="btn btn-secondary">Add Payment Method</button>
                </div>
            </div>

            <!-- Advanced Settings -->
            <div class="settings-panel" id="advanced-panel">
                <div class="panel-header">
                    <h2>Advanced Settings</h2>
                    <p>Configure advanced options and preferences</p>
                </div>

                <div class="settings-card">
                    <h3>Data & Storage</h3>
                    <div class="storage-info">
                        <div class="storage-bar">
                            <div class="storage-used" style="width: 35%;"></div>
                        </div>
                        <p>Using 3.5 GB of 10 GB</p>
                    </div>
                    <button class="btn btn-secondary">Clear Cache</button>
                </div>

                <div class="settings-card">
                    <h3>Developer Options</h3>
                    <div class="toggle-group">
                        <div class="toggle-item">
                            <div>
                                <h4>API Access</h4>
                                <p>Enable API access for third-party apps</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>API Key</label>
                        <div class="api-key-group">
                            <input type="text" value="sk_test_1234567890abcdef" readonly>
                            <button class="btn btn-secondary-small">Regenerate</button>
                        </div>
                    </div>
                </div>

                <div class="settings-card">
                    <h3>Export Data</h3>
                    <p>Download a copy of your DevConnect data</p>
                    <button class="btn btn-secondary">Request Data Export</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- GSAP Animation Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

<script src="/js/settings.js"></script>
<script>
// Delete Account Confirmation
const deleteAccountBtn = document.getElementById('deleteAccountBtn');
if(deleteAccountBtn) {
    deleteAccountBtn.addEventListener('click', function() {
        const confirmed = confirm('⚠️ WARNING: Are you sure you want to delete your account?\n\nThis action will:\n• Delete all your projects\n• Remove you from all teams\n• Permanently delete all your data\n\nThis action CANNOT be undone!');
        
        if(confirmed) {
            const doubleConfirm = confirm('This is your last chance!\n\nType your confirmation by clicking OK to permanently delete your account.');
            
            if(doubleConfirm) {
                // Create a form and submit DELETE request
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/settings/account?_method=DELETE';
                document.body.appendChild(form);
                form.submit();
            }
        }
    });
}

// GSAP Animations
gsap.fromTo('.settings-header',
    { opacity: 0, y: -30 },
    { opacity: 1, y: 0, duration: 0.6, ease: 'power3.out' }
);

gsap.fromTo('.settings-sidebar',
    { opacity: 0, x: -30 },
    { opacity: 1, x: 0, duration: 0.5, delay: 0.2, ease: 'power2.out' }
);

gsap.fromTo('.settings-panels',
    { opacity: 0, x: 30 },
    { opacity: 1, x: 0, duration: 0.5, delay: 0.3, ease: 'power2.out' }
);
</script>
