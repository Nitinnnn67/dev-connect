<% layout("/layout/boilerplate") %>

<link rel="stylesheet" href="/css/search.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- Search Container -->
<div class="search-container">
    <!-- Search Header -->
    <section class="search-header">
        <div class="header-content">
            <h1>Search</h1>
            <p>Find projects, developers, and opportunities</p>
        </div>
    </section>

    <!-- Search Section -->
    <section class="search-section">
        <div class="search-wrapper">
            <div class="search-bar-main">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search for projects, users, skills..." value="<%= query || '' %>">
                <button class="search-btn">Search</button>
            </div>

            <div class="search-filters">
                <button class="filter-tab active" data-type="all">
                    <i class="fas fa-th"></i>
                    All Results
                </button>
                <button class="filter-tab" data-type="projects">
                    <i class="fas fa-folder"></i>
                    Projects
                </button>
                <button class="filter-tab" data-type="users">
                    <i class="fas fa-users"></i>
                    Developers
                </button>
                <button class="filter-tab" data-type="skills">
                    <i class="fas fa-code"></i>
                    Skills
                </button>
            </div>
        </div>
    </section>

    <!-- Search Results -->
    <div class="search-results">
        <% if(query && query.trim().length > 0) { %>
            <div class="results-header">
                <h2>Search Results for "<%= query %>"</h2>
                <span class="results-count">Found <%= resultsCount %> result<%= resultsCount !== 1 ? 's' : '' %></span>
            </div>

            <!-- Projects Results -->
            <% if((filter === 'all' || filter === 'projects') && projects && projects.length > 0) { %>
            <div class="results-section" id="projectsResults">
                <h3 class="section-title"><i class="fas fa-folder"></i> Projects (<%= projects.length %>)</h3>
                <div class="results-grid">
                    <% projects.forEach(project => { %>
                        <div class="result-card project-card" data-type="projects">
                            <div class="card-icon">
                                <i class="fas fa-rocket"></i>
                            </div>
                            <div class="card-content">
                                <div class="card-header">
                                    <h4><%= project.title %></h4>
                                    <% 
                                        let statusClass = 'status-' + project.status;
                                        let statusText = project.status === 'in-progress' ? 'In Progress' : 
                                                        project.status.charAt(0).toUpperCase() + project.status.slice(1);
                                    %>
                                    <span class="status-badge <%= statusClass %>"><%= statusText %></span>
                                </div>
                                <p class="card-description"><%= project.description ? project.description.substring(0, 100) : 'No description' %><%= project.description && project.description.length > 100 ? '...' : '' %></p>
                                <% if(project.techStack && project.techStack.length > 0) { %>
                                    <div class="card-tags">
                                        <% project.techStack.slice(0, 3).forEach(tech => { %>
                                            <span class="tag"><%= tech %></span>
                                        <% }); %>
                                        <% if(project.techStack.length > 3) { %>
                                            <span class="tag">+<%= project.techStack.length - 3 %></span>
                                        <% } %>
                                    </div>
                                <% } %>
                                <div class="card-meta">
                                    <span><i class="fas fa-users"></i> <%= project.members ? project.members.length : 0 %>/<%= project.teamSize || 'Open' %></span>
                                    <% if(project.createdBy) { %>
                                        <span><i class="fas fa-user"></i> <%= project.createdBy.name || project.createdBy.username %></span>
                                    <% } %>
                                </div>
                            </div>
                            <a href="/projects/<%= project._id %>" class="card-link">View Project</a>
                        </div>
                    <% }); %>
                </div>
            </div>
            <% } %>

            <!-- Users Results -->
            <% if((filter === 'all' || filter === 'users') && users && users.length > 0) { %>
            <div class="results-section" id="usersResults">
                <h3 class="section-title"><i class="fas fa-users"></i> Developers (<%= users.length %>)</h3>
                <div class="results-grid">
                    <% users.forEach(user => { %>
                        <div class="result-card user-card" data-type="users">
                            <img src="https://ui-avatars.com/api/?name=<%= encodeURIComponent(user.name || user.username) %>&size=80&background=11293A&color=fff" alt="<%= user.name || user.username %>">
                            <div class="card-content">
                                <h4><%= user.name || user.username %></h4>
                                <p class="user-title">@<%= user.username %></p>
                                <% if(user.bio) { %>
                                    <p class="user-bio"><%= user.bio.substring(0, 80) %><%= user.bio.length > 80 ? '...' : '' %></p>
                                <% } else { %>
                                    <p class="user-bio">No bio available</p>
                                <% } %>
                                <% if(user.skills && user.skills.length > 0) { %>
                                    <div class="card-tags">
                                        <% user.skills.slice(0, 3).forEach(skill => { %>
                                            <span class="tag"><%= skill %></span>
                                        <% }); %>
                                        <% if(user.skills.length > 3) { %>
                                            <span class="tag">+<%= user.skills.length - 3 %></span>
                                        <% } %>
                                    </div>
                                <% } %>
                                <div class="card-meta">
                                    <% if(user.location) { %>
                                        <span><i class="fas fa-map-marker-alt"></i> <%= user.location %></span>
                                    <% } %>
                                    <% if(user.projectsCreated) { %>
                                        <span><i class="fas fa-folder"></i> <%= user.projectsCreated.length || 0 %> Projects</span>
                                    <% } %>
                                </div>
                            </div>
                            <a href="/users/<%= user._id %>" class="card-link">View Profile</a>
                        </div>
                    <% }); %>
                </div>
            </div>
            <% } %>

            <!-- No Results State -->
            <% if(resultsCount === 0) { %>
            <div class="no-results" id="noResults">
                <i class="fas fa-search"></i>
                <h3>No results found</h3>
                <p>Try different keywords or check your spelling</p>
                <a href="/search" class="btn-primary">Clear Search</a>
            </div>
            <% } %>
        <% } else { %>
            <!-- Empty State -->
            <div class="empty-state">
                <i class="fas fa-search"></i>
                <h3>Start Searching</h3>
                <p>Search for projects, developers, or skills to get started</p>
                <div class="popular-searches">
                    <h4>Popular Searches:</h4>
                    <div class="popular-tags">
                        <a href="/search?query=React&filter=all" class="popular-tag">React</a>
                        <a href="/search?query=Node.js&filter=all" class="popular-tag">Node.js</a>
                        <a href="/search?query=Python&filter=all" class="popular-tag">Python</a>
                        <a href="/search?query=JavaScript&filter=all" class="popular-tag">JavaScript</a>
                        <a href="/search?query=AI&filter=all" class="popular-tag">AI</a>
                        <a href="/search?query=Mobile&filter=all" class="popular-tag">Mobile</a>
                    </div>
                </div>
            </div>
        <% } %>
    </div>
</div>

<!-- GSAP Animation Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

<script src="/js/search.js"></script>
<script>
// GSAP Animations
gsap.fromTo('.search-header',
    { opacity: 0, y: -30 },
    { opacity: 1, y: 0, duration: 0.6, ease: 'power3.out' }
);

gsap.fromTo('.search-bar-main',
    { opacity: 0, scale: 0.95 },
    { opacity: 1, scale: 1, duration: 0.5, delay: 0.2, ease: 'back.out(1.2)' }
);

gsap.fromTo('.filter-tab',
    { opacity: 0, y: 20 },
    { opacity: 1, y: 0, duration: 0.4, stagger: 0.08, delay: 0.4, ease: 'power2.out' }
);

gsap.fromTo('.result-card',
    { opacity: 0, y: 30 },
    { opacity: 1, y: 0, duration: 0.5, stagger: 0.1, delay: 0.6, ease: 'power2.out' }
);
</script>
